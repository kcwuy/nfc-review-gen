<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å¥èº«æˆ¿å¥½è¯„ç”Ÿæˆå™¨</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
      background: #f9f9f9;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #2c6fbb;
      margin-bottom: 20px;
    }
    .btn-group {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin: 20px 0;
    }
    button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      background: #2c6fbb;
      color: white;
      font-size: 16px;
      cursor: pointer;
      flex: 1;
      max-width: 200px;
    }
    button:hover {
      opacity: 0.9;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #status {
      margin-top: 20px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      min-height: 60px;
    }
    pre {
      background: #f1f1f1;
      padding: 10px;
      border-radius: 4px;
      white-space: pre-wrap;
      word-break: break-word;
      margin-top: 10px;
    }
    .error { color: #d32f2f; }
    .success { color: #2e7d32; }
  </style>
</head>
<body>
  <h1>ğŸ’ª å¥èº«æˆ¿å¥½è¯„ç”Ÿæˆå™¨</h1>
  
  <div class="btn-group">
    <button id="btn-private">ç§æ•™è¯¾</button>
    <button id="btn-gym">è‡ªç”±å¥èº«</button>
  </div>

  <div id="status">è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ç”Ÿæˆå¥½è¯„</div>

  <script>
    // ==============================
    // âš ï¸ å·²å¡«å…¥ä½ çš„ DashScope API Key
    // ==============================
    const API_KEY = "sk-01fac1f64f304d009642584715fe809c";

    // ç³»ç»Ÿæç¤ºè¯ï¼ˆå¯æŒ‰éœ€ä¿®æ”¹ï¼‰
    const PROMPTS = {
      private: "ä½ æ˜¯ä¸€ä½ç»å¸¸ä¸Šç§æ•™è¯¾çš„ä¼šå‘˜ï¼Œè¯·ç”Ÿæˆä¸€æ¡50å­—å·¦å³çš„ä¸­æ–‡å¥½è¯„ï¼Œè¯­æ°”è‡ªç„¶çœŸè¯šï¼Œçªå‡ºæ•™ç»ƒä¸“ä¸šã€è€å¿ƒã€è®­ç»ƒè®¡åˆ’æœ‰æ•ˆï¼Œä¸è¦ç”¨å¤¸å¼ è¯æ±‡ã€‚",
      gym: "ä½ æ˜¯ä¸€ä½å¸¸å»è‡ªç”±å¥èº«çš„ç”¨æˆ·ï¼Œè¯·ç”Ÿæˆä¸€æ¡50å­—å·¦å³çš„ä¸­æ–‡å¥½è¯„ï¼Œè¯­æ°”è‡ªç„¶çœŸè¯šï¼Œçªå‡ºåœºåœ°å¹²å‡€ã€å™¨æ¢°é½å…¨ã€æ°›å›´å¥½ï¼Œä¸è¦ç”¨å¤¸å¼ è¯æ±‡ã€‚"
    };

    if (location.protocol !== 'https:') {
      document.getElementById('status').innerHTML = 
        '<div class="error">âŒ å¿…é¡»é€šè¿‡ HTTPS è®¿é—®ï¼ˆå¦‚ GitHub Pagesï¼‰</div>';
    }

    async function generateReview(type) {
      const statusEl = document.getElementById('status');
      const btnPrivate = document.getElementById('btn-private');
      const btnGym = document.getElementById('btn-gym');

      // ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
      btnPrivate.disabled = true;
      btnGym.disabled = true;
      statusEl.innerHTML = 'æ­£åœ¨ç”Ÿæˆä¸­...';

      try {
        const response = await fetch("https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${API_KEY}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: "qwen-turbo",
            input: {
              messages: [{
                role: "user",
                content: PROMPTS[type]
              }]
            }
          })
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errorText}`);
        }

        const data = await response.json();
        const review = data.output.choices[0].message.content.trim();

        // å°è¯•è‡ªåŠ¨å¤åˆ¶
        try {
          await navigator.clipboard.writeText(review);
          statusEl.innerHTML = `
            <div class="success">âœ… å¥½è¯„å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼</div>
            <p>ç°åœ¨å¯ä»¥ç²˜è´´åˆ°å¤§ä¼—ç‚¹è¯„ã€ç¾å›¢ç­‰ App äº†ã€‚</p>
            <pre>${review}</pre>
          `;
        } catch (copyErr) {
          // iOS Safari å¤‡ç”¨æ–¹æ¡ˆ
          statusEl.innerHTML = `
            <div class="error">âš ï¸ æ— æ³•è‡ªåŠ¨å¤åˆ¶ï¼ˆSafari é™åˆ¶ï¼‰</div>
            <p>è¯·æ‰‹åŠ¨ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¤åˆ¶ï¼š</p>
            <button onclick="copyText(\`${review.replace(/`/g, '\\`')}\`)">ğŸ“‹ å¤åˆ¶å¥½è¯„</button>
            <pre>${review}</pre>
          `;
        }
      } catch (err) {
        console.error("ç”Ÿæˆå¤±è´¥:", err);
        statusEl.innerHTML = `
          <div class="error">âŒ ç”Ÿæˆå¤±è´¥</div>
          <p><strong>åŸå› ï¼š</strong>${err.message || 'æœªçŸ¥é”™è¯¯'}</p>
          <p>ğŸ‘‰ è¯·æ£€æŸ¥ï¼š<br>
            â€¢ æ˜¯å¦å·²å¼€é€š qwen-turbo æ¨¡å‹<br>
            â€¢ ç½‘ç»œæ˜¯å¦æ­£å¸¸
          </p>
        `;
      } finally {
        // æ¢å¤æŒ‰é’®
        btnPrivate.disabled = false;
        btnGym.disabled = false;
      }
    }

    function copyText(text) {
      navigator.clipboard.writeText(text).then(() => {
        alert("âœ… å·²å¤åˆ¶ï¼");
      }).catch(() => {
        alert("è¯·é•¿æŒ‰æ–‡æœ¬æ‰‹åŠ¨å¤åˆ¶");
      });
    }

    // ç»‘å®šæŒ‰é’®äº‹ä»¶
    document.getElementById('btn-private').addEventListener('click', () => generateReview('private'));
    document.getElementById('btn-gym').addEventListener('click', () => generateReview('gym'));
  </script>
</body>
</html>
